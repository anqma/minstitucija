<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Moja Institucija | Lista na kategorii</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/map.css">
</head>
<body>
<script>

    const successCallback=(position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;


        var sourcelocation = document.getElementById("source").getAttribute("value").toString();
        console.log(sourcelocation);
        const source = "https://learngis2.maps.arcgis.com/apps/Embed/index.html?webmap=" + sourcelocation + "&extent=21.1075,41.903,21.8257,42.1371&marker=" + longitude + ";" + latitude + ";;My%20location&zoom=true&previewImage=false&scale=true&disable_scroll=true&theme=light";
        /*const source="//learngis2.maps.arcgis.com/apps/Embed/index.html?webmap=3b4f66ffeeb445cdb3e4702af138ea2b&extent=21.1075,41.903,21.8257,42.1371&marker="+longitude+";"+latitude+";;My location&zoom=true&previewImage=false&scale=true&legend=true&disable_scroll=true&theme=light";*/
        document.getElementById("location").setAttribute("src", source);

        var locationLon = document.getElementById("longitude").getAttribute("value").toString();
        var locationLat = document.getElementById("latitude").getAttribute("value").toString();

        var R = 6371; // Radius of the earth in km
        var locationLon = document.getElementById("longitude").getAttribute("value").toString();
        var locationLat = document.getElementById("latitude").getAttribute("value").toString();

        var dLat = deg2rad(parseFloat(latitude)-parseFloat(locationLat));
        console.log(dLat)// deg2rad below
        var dLon = deg2rad(parseFloat(longitude)-parseFloat(locationLon));
        var a =
            Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(parseFloat(locationLat))) * Math.cos(deg2rad(parseFloat(latitude))) *
            Math.sin(dLon/2) * Math.sin(dLon/2)
        ;
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        var d = (R * c).toFixed(2); // Distance in km
        function deg2rad(deg) {
            return deg * (Math.PI/180)
        }
        document.getElementById("distanca").innerText="Оддалечени сте од бараната локација: "+d+"km";
    };
    const errorCallback=(error) =>{
        console.error(error);
    };
    navigator.geolocation.getCurrentPosition(successCallback,errorCallback);


</script>
<a href="/categories">Назад</a><input type="hidden" th:value="${source}" id="source">
<input type="hidden" th:value="${locationLon}" id="longitude">
<input type="hidden" th:value="${locationLat}" id="latitude">
<div class="box">
    <h4><span>Моја</span>Институција</h4>
</div>

<div class="categories">
    <div class="address"><i class="fa fa-map-marker"></i>
        <p>
        <th:block th:text="${name}"></th:block> <br>
        Адреса: <th:block th:text="${address}"></th:block>
        <br/><span id="distanca"></span>

        </p>
    </div>
    <div class="myDiv">
        <style>.embed-container {
            position: relative;
            padding-bottom: 50%;
            height: 0;
            max-width: 100%;
        }

        .embed-container iframe, .embed-container object, .embed-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 8px solid #ff8b3d;
            border-radius: 30px 30px 30px 30px;
            box-shadow: 10px 10px 8px #ff8b3d;
        }

        small {
            position: absolute;
            z-index: 40;
            bottom: 0;
            margin-bottom: -15px;
        }</style>
        <div class="embed-container">
            <iframe id="location" width="500" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                    th:title="${name}"></iframe>
        </div>
    </div>

</div>
</body>
</html>